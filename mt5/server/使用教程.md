# MT5äº¤æ˜“æœåŠ¡å™¨ä½¿ç”¨æ•™ç¨‹

## ğŸ“‹ ç›®å½•
1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [åŸºç¡€äº¤æ˜“æ“ä½œ](#åŸºç¡€äº¤æ˜“æ“ä½œ)
3. [é«˜çº§åŠŸèƒ½](#é«˜çº§åŠŸèƒ½)
4. [æ—¶é—´åŒºé—´æ§åˆ¶](#æ—¶é—´åŒºé—´æ§åˆ¶)
5. [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)
6. [å¼€å‘è°ƒè¯•](#å¼€å‘è°ƒè¯•)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æœåŠ¡å™¨
```bash
cd mt5/server
python app.py
```

æœåŠ¡å™¨å¯åŠ¨åä¼šæ˜¾ç¤ºï¼š
```
MT5: CONNECTED - Account: 67424067
Trading hours manager initialized with 4 custom intervals
Server running on http://127.0.0.1:5000
```

### 2. å¥åº·æ£€æŸ¥
```bash
curl http://127.0.0.1:5000/health
```

## ğŸ“ˆ åŸºç¡€äº¤æ˜“æ“ä½œ

### å¼€ä»“æ“ä½œ

#### å¼€å¤šä»“ï¼ˆä¹°å…¥ï¼‰
```bash
# åŸºç¡€å¼€å¤š
curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: text/plain; charset=utf-8" \
  -d "å¼€å¤š XAUUSD"

# æŒ‡å®šä»“ä½å¤§å°
curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: text/plain; charset=utf-8" \
  -d "å¼€å¤š XAUUSD ä»“ä½=0.05"

# å¸¦æ­¢æŸæ­¢ç›ˆ
curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: text/plain; charset=utf-8" \
  -d "å¼€å¤š XAUUSD ä»“ä½=0.1 æ­¢æŸ=3350 æ­¢ç›ˆ=3370"
```

#### å¼€ç©ºä»“ï¼ˆå–å‡ºï¼‰
```bash
# åŸºç¡€å¼€ç©º
curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: text/plain; charset=utf-8" \
  -d "å¼€ç©º EURUSD"

# æŒ‡å®šä»“ä½å¤§å°
curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: text/plain; charset=utf-8" \
  -d "å¼€ç©º EURUSD ä»“ä½=0.2"
```

### å¹³ä»“æ“ä½œ

#### å¹³å¤šä»“
```bash
# å¹³æŒ‡å®šæ•°é‡çš„å¤šä»“
curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: text/plain; charset=utf-8" \
  -d "å¹³å¤š XAUUSD ä»“ä½=0.05"

# å¹³æ‰€æœ‰å¤šä»“
curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: text/plain; charset=utf-8" \
  -d "å¹³å¤š XAUUSD"
```

#### å¹³ç©ºä»“
```bash
# å¹³æŒ‡å®šæ•°é‡çš„ç©ºä»“
curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: text/plain; charset=utf-8" \
  -d "å¹³ç©º EURUSD ä»“ä½=0.1"

# å¹³æ‰€æœ‰ç©ºä»“
curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: text/plain; charset=utf-8" \
  -d "å¹³ç©º EURUSD"
```

#### å…¨å¹³ä»“
```bash
# å¹³æ‰€æœ‰æŒä»“
curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: text/plain; charset=utf-8" \
  -d "å…¨å¹³"

# å¹³æŒ‡å®šå“ç§çš„æ‰€æœ‰æŒä»“
curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: text/plain; charset=utf-8" \
  -d "å…¨å¹³ XAUUSD"
```


## ğŸ”§ é«˜çº§åŠŸèƒ½

### JSONæ ¼å¼è¯·æ±‚
```bash
curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: application/json" \
  -d '{
    "action": "buy",
    "symbol": "XAUUSD",
    "volume": 0.05,
    "sl": 3350,
    "tp": 3370,
    "comment": "APIäº¤æ˜“"
  }'
```

### ä¿®æ”¹æŒä»“
```bash
# ä¿®æ”¹æ­¢æŸæ­¢ç›ˆ
curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: application/json" \
  -d '{
    "action": "modify",
    "symbol": "XAUUSD",
    "ticket": 3824696857,
    "sl": 3355,
    "tp": 3375
  }'
```

### æŸ¥è¯¢æ“ä½œ
```bash
# æŸ¥çœ‹è´¦æˆ·ä¿¡æ¯
curl http://127.0.0.1:5000/status

# æŸ¥çœ‹æŒä»“
curl http://127.0.0.1:5000/positions

# æŸ¥çœ‹è®¢å•
curl http://127.0.0.1:5000/orders
```

## â° æ—¶é—´åŒºé—´æ§åˆ¶

### å¼€å¯æ—¶é—´åŒºé—´
```bash
curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: text/plain; charset=utf-8" \
  -d "å¼€å¯æ—¶é—´åŒºé—´"
```

### æ—¶é—´æ®µé…ç½®
ç³»ç»Ÿé¢„é…ç½®äº†4ä¸ªæ—¶é—´æ®µï¼š
- **æ—¶æ®µ1**: æ¬§æ´²æ—¶æ®µ (08:00-16:00 London)
- **æ—¶æ®µ2**: ç¾æ´²æ—¶æ®µ (14:00-22:00 New York)
- **æ—¶æ®µ3**: äºšæ´²æ—¶æ®µ (01:00-09:00 GMT+8)
- **æ—¶æ®µ4**: äºšæ´²æ—¶æ®µ (13:00-15:00 GMT+8)

### è‡ªå®šä¹‰æ—¶é—´æ®µ
ç¼–è¾‘ `config.yaml` æ–‡ä»¶ï¼š
```yaml
custom_intervals:
  interval5:
    name: "è‡ªå®šä¹‰æ—¶æ®µ5"
    start_time: "09:00"
    end_time: "17:00"
    timezone: "GMT+8"
    description: "å·¥ä½œæ—¶é—´"
```

## ğŸ¯ å¸¸ç”¨äº¤æ˜“å“ç§

### å¤–æ±‡
- **EURUSD** - æ¬§å…ƒ/ç¾å…ƒ
- **GBPUSD** - è‹±é•‘/ç¾å…ƒ
- **USDJPY** - ç¾å…ƒ/æ—¥å…ƒ
- **AUDUSD** - æ¾³å…ƒ/ç¾å…ƒ

### è´µé‡‘å±
- **XAUUSD** - é»„é‡‘/ç¾å…ƒ
- **XAGUSD** - ç™½é“¶/ç¾å…ƒ

### åŸæ²¹
- **USOIL** - ç¾åŸæ²¹
- **UKOIL** - å¸ƒä¼¦ç‰¹åŸæ²¹

## âŒ é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

#### 1. äº¤æ˜“æ—¶é—´é™åˆ¶
```json
{
  "error": "Trading not allowed at current time due to trading hours restrictions"
}
```
**è§£å†³æ–¹æ¡ˆ**: å…ˆæ‰§è¡Œ `å¼€å¯æ—¶é—´åŒºé—´` å‘½ä»¤

#### 2. å¡«å……æ¨¡å¼é”™è¯¯
```json
{
  "error": "Unsupported filling mode"
}
```
**è§£å†³æ–¹æ¡ˆ**: ç³»ç»Ÿå·²è‡ªåŠ¨ä¿®å¤ï¼Œä¼šè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜å¡«å……æ¨¡å¼

#### 3. è¿æ¥æ–­å¼€
```json
{
  "error": "Not connected to MT5"
}
```
**è§£å†³æ–¹æ¡ˆ**: ç³»ç»Ÿå…·å¤‡è‡ªåŠ¨é‡è¿åŠŸèƒ½ï¼Œä¼šè‡ªåŠ¨å°è¯•é‡è¿

#### 4. è‡ªåŠ¨äº¤æ˜“ç¦ç”¨
```json
{
  "error": "AutoTrading disabled by client"
}
```
**è§£å†³æ–¹æ¡ˆ**: åœ¨MT5å®¢æˆ·ç«¯å¯ç”¨è‡ªåŠ¨äº¤æ˜“

## ğŸ› ï¸ å¼€å‘è°ƒè¯•

### VSCodeè°ƒè¯•
1. æ‰“å¼€ `mt5/server` ç›®å½•
2. æŒ‰ `F5` é€‰æ‹© "å¯åŠ¨MT5æœåŠ¡å™¨"
3. è®¾ç½®æ–­ç‚¹è¿›è¡Œè°ƒè¯•

### æµ‹è¯•è„šæœ¬
```bash
# æµ‹è¯•è‡ªåŠ¨é‡è¿
python test_auto_reconnect.py

# æµ‹è¯•å¡«å……æ¨¡å¼
python test_filling_mode.py

# æµ‹è¯•æ—¶åŒºè§£æ
python test_timezone.py
```

### æ—¥å¿—æŸ¥çœ‹
æœåŠ¡å™¨è¿è¡Œæ—¶ä¼šæ˜¾ç¤ºè¯¦ç»†æ—¥å¿—ï¼š
```
2025-07-25 13:52:18 - INFO - TRADE: BUY 0.05 XAUUSD @ 3355.97 - Success
2025-07-25 13:52:30 - INFO - TRADE: CLOSE 0.05 XAUUSD @ 3355.85 - Success
```

## ğŸ“Š å“åº”æ ¼å¼

### æˆåŠŸå“åº”
```json
{
  "success": true,
  "message": "Trade executed successfully",
  "result": {
    "action": "buy",
    "symbol": "XAUUSD",
    "volume": 0.05,
    "price": 3355.97,
    "ticket": 3824696857,
    "timestamp": "2025-07-25T13:52:18.230604"
  }
}
```

### é”™è¯¯å“åº”
```json
{
  "success": false,
  "error": "Error message",
  "timestamp": "2025-07-25T13:52:18.230604"
}
```

## ğŸ” å®‰å…¨é…ç½®

### APIå¯†é’¥ï¼ˆå¯é€‰ï¼‰
åœ¨ `config.yaml` ä¸­é…ç½®ï¼š
```yaml
server:
  security:
    api_key: "your-secret-key"
```

ä½¿ç”¨æ—¶æ·»åŠ å¤´éƒ¨ï¼š
```bash
curl -X POST http://127.0.0.1:5000/webhook \
  -H "X-API-Key: your-secret-key" \
  -H "Content-Type: text/plain; charset=utf-8" \
  -d "å¼€å¤š XAUUSD"
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥
- **å¼€å¤š**: `å¼€å¤š å“ç§ [ä»“ä½=æ•°é‡] [æ­¢æŸ=ä»·æ ¼] [æ­¢ç›ˆ=ä»·æ ¼]`
- **å¼€ç©º**: `å¼€ç©º å“ç§ [ä»“ä½=æ•°é‡] [æ­¢æŸ=ä»·æ ¼] [æ­¢ç›ˆ=ä»·æ ¼]`
- **å¹³å¤š**: `å¹³å¤š å“ç§ [ä»“ä½=æ•°é‡]`
- **å¹³ç©º**: `å¹³ç©º å“ç§ [ä»“ä½=æ•°é‡]`
- **å…¨å¹³**: `å…¨å¹³ [å“ç§]`
- **æ—¶é—´æ§åˆ¶**: `å¼€å¯æ—¶é—´åŒºé—´`

### è·å–å¸®åŠ©
- æŸ¥çœ‹æ—¥å¿—äº†è§£è¯¦ç»†é”™è¯¯ä¿¡æ¯
- ä½¿ç”¨å¥åº·æ£€æŸ¥ç¡®è®¤ç³»ç»ŸçŠ¶æ€
- å‚è€ƒç¤ºä¾‹æ–‡ä»¶ `TRADINGVIEW_WEBHOOK_EXAMPLES.md`

## ğŸ”„ TradingViewé›†æˆ

### Webhooké…ç½®
1. åœ¨TradingViewç­–ç•¥ä¸­æ·»åŠ ï¼š
```pinescript
strategy.entry("Long", strategy.long, when=buy_condition)
strategy.close("Long", when=sell_condition)

// Webhookæ¶ˆæ¯
if buy_condition
    alert("å¼€å¤š {{ticker}} ä»“ä½=0.1", alert.freq_once_per_bar)
if sell_condition
    alert("å¹³å¤š {{ticker}}", alert.freq_once_per_bar)
```

2. è®¾ç½®Webhook URL: `http://127.0.0.1:5000/webhook`

### Pine Scriptç¤ºä¾‹
```pinescript
//@version=5
strategy("MT5 Webhook Strategy", overlay=true)

// ç­–ç•¥å‚æ•°
volume = input.float(0.1, "Position Size")
sl_percent = input.float(1.0, "Stop Loss %")
tp_percent = input.float(2.0, "Take Profit %")

// äº¤æ˜“ä¿¡å·
ma20 = ta.sma(close, 20)
ma50 = ta.sma(close, 50)

buy_signal = ta.crossover(ma20, ma50)
sell_signal = ta.crossunder(ma20, ma50)

// æ‰§è¡Œäº¤æ˜“
if buy_signal
    strategy.entry("Long", strategy.long)
    alert("å¼€å¤š " + syminfo.ticker + " ä»“ä½=" + str.tostring(volume), alert.freq_once_per_bar)

if sell_signal
    strategy.close("Long")
    alert("å¹³å¤š " + syminfo.ticker, alert.freq_once_per_bar)
```

## ğŸ“± PowerShellè„šæœ¬ç¤ºä¾‹

### æ‰¹é‡äº¤æ˜“è„šæœ¬
```powershell
# MT5äº¤æ˜“è„šæœ¬
$baseUrl = "http://127.0.0.1:5000/webhook"
$headers = @{"Content-Type" = "text/plain; charset=utf-8"}

# å¼€å¯æ—¶é—´åŒºé—´
Invoke-RestMethod -Uri $baseUrl -Method POST -Body "å¼€å¯æ—¶é—´åŒºé—´" -Headers $headers

# æ‰¹é‡å¼€ä»“
$symbols = @("XAUUSD", "EURUSD", "GBPUSD")
foreach ($symbol in $symbols) {
    $body = "å¼€å¤š $symbol ä»“ä½=0.05"
    try {
        $result = Invoke-RestMethod -Uri $baseUrl -Method POST -Body $body -Headers $headers
        Write-Host "âœ… $symbol å¼€ä»“æˆåŠŸ: $($result.result.ticket)"
    }
    catch {
        Write-Host "âŒ $symbol å¼€ä»“å¤±è´¥: $($_.Exception.Message)"
    }
    Start-Sleep -Seconds 1
}
```

### ç›‘æ§è„šæœ¬
```powershell
# è´¦æˆ·ç›‘æ§è„šæœ¬
function Get-AccountStatus {
    try {
        $status = Invoke-RestMethod -Uri "http://127.0.0.1:5000/health"
        $balance = $status.account_info.balance
        $equity = $status.account_info.equity
        $profit = $equity - $balance

        Write-Host "è´¦æˆ·ä½™é¢: $balance USD"
        Write-Host "è´¦æˆ·å‡€å€¼: $equity USD"
        Write-Host "æµ®åŠ¨ç›ˆäº: $profit USD"

        return $status.mt5_connected
    }
    catch {
        Write-Host "âŒ æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨"
        return $false
    }
}

# æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
while ($true) {
    Clear-Host
    Write-Host "=== MT5è´¦æˆ·ç›‘æ§ ===" -ForegroundColor Green
    Write-Host "æ—¶é—´: $(Get-Date)" -ForegroundColor Yellow

    if (Get-AccountStatus) {
        Write-Host "âœ… MT5è¿æ¥æ­£å¸¸" -ForegroundColor Green
    } else {
        Write-Host "âŒ MT5è¿æ¥å¼‚å¸¸" -ForegroundColor Red
    }

    Start-Sleep -Seconds 30
}
```

## ğŸ›ï¸ é…ç½®æ–‡ä»¶è¯¦è§£

### config.yamlå®Œæ•´é…ç½®
```yaml
# MT5è¿æ¥é…ç½®
mt5:
  terminal_path: ""  # MT5ç»ˆç«¯è·¯å¾„ï¼ˆå¯é€‰ï¼‰

# äº¤æ˜“é…ç½®
trading:
  default_volume: 0.1      # é»˜è®¤æ‰‹æ•°
  max_volume: 10.0         # æœ€å¤§æ‰‹æ•°
  min_volume: 0.01         # æœ€å°æ‰‹æ•°
  max_slippage: 3          # æœ€å¤§æ»‘ç‚¹
  magic_number: 12345      # é­”æœ¯æ•°å­—
  allowed_symbols: []      # å…è®¸çš„äº¤æ˜“å“ç§ï¼ˆç©º=å…¨éƒ¨ï¼‰

# è‡ªå®šä¹‰æ—¶é—´æ®µ
custom_intervals:
  interval1:
    name: "æ¬§æ´²æ—¶æ®µ"
    start_time: "08:00"
    end_time: "16:00"
    timezone: "Europe/London"
    description: "ä¼¦æ•¦äº¤æ˜“æ—¶é—´"

# æœåŠ¡å™¨é…ç½®
server:
  host: "127.0.0.1"
  port: 5000
  debug: false
  security:
    api_key: ""  # APIå¯†é’¥ï¼ˆå¯é€‰ï¼‰

# æ—¥å¿—é…ç½®
logging:
  level: "INFO"
  file: "mt5_server.log"
  console: true
```

## ğŸš¨ é£é™©ç®¡ç†

### ä»“ä½ç®¡ç†
```bash
# å°ä»“ä½æµ‹è¯•
curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: text/plain; charset=utf-8" \
  -d "å¼€å¤š XAUUSD ä»“ä½=0.01"

# åˆ†æ‰¹å»ºä»“
curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: text/plain; charset=utf-8" \
  -d "å¼€å¤š XAUUSD ä»“ä½=0.05 å¤‡æ³¨=ç¬¬ä¸€æ‰¹"

curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: text/plain; charset=utf-8" \
  -d "å¼€å¤š XAUUSD ä»“ä½=0.05 å¤‡æ³¨=ç¬¬äºŒæ‰¹"
```

### æ­¢æŸæ­¢ç›ˆè®¾ç½®
```bash
# ç™¾åˆ†æ¯”æ­¢æŸ
curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: text/plain; charset=utf-8" \
  -d "å¼€å¤š XAUUSD ä»“ä½=0.1 æ­¢æŸç™¾åˆ†æ¯”=1 æ­¢ç›ˆç™¾åˆ†æ¯”=2"

# å›ºå®šç‚¹æ•°æ­¢æŸ
curl -X POST http://127.0.0.1:5000/webhook \
  -H "Content-Type: text/plain; charset=utf-8" \
  -d "å¼€å¤š EURUSD ä»“ä½=0.1 æ­¢æŸ=1.0950 æ­¢ç›ˆ=1.1050"
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æ‰¹é‡æ“ä½œ
```python
import requests
import json

# Pythonæ‰¹é‡äº¤æ˜“ç¤ºä¾‹
def batch_trade():
    url = "http://127.0.0.1:5000/webhook"
    headers = {"Content-Type": "application/json"}

    trades = [
        {"action": "buy", "symbol": "XAUUSD", "volume": 0.05},
        {"action": "buy", "symbol": "EURUSD", "volume": 0.1},
        {"action": "buy", "symbol": "GBPUSD", "volume": 0.1}
    ]

    for trade in trades:
        try:
            response = requests.post(url, json=trade, headers=headers)
            result = response.json()
            if result.get("success"):
                print(f"âœ… {trade['symbol']} äº¤æ˜“æˆåŠŸ")
            else:
                print(f"âŒ {trade['symbol']} äº¤æ˜“å¤±è´¥: {result.get('error')}")
        except Exception as e:
            print(f"âŒ è¯·æ±‚å¤±è´¥: {e}")
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜è¯Šæ–­

#### 1. æœåŠ¡å™¨æ— æ³•å¯åŠ¨
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :5000

# æ£€æŸ¥Pythonç¯å¢ƒ
python --version
pip list | findstr MetaTrader5
```

#### 2. MT5è¿æ¥å¤±è´¥
- ç¡®ä¿MT5å®¢æˆ·ç«¯å·²ç™»å½•
- æ£€æŸ¥è‡ªåŠ¨äº¤æ˜“æ˜¯å¦å¯ç”¨
- éªŒè¯è´¦æˆ·æƒé™

#### 3. äº¤æ˜“å¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
curl http://127.0.0.1:5000/health | python -m json.tool
```

### æ—¥å¿—åˆ†æ
```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -f mt5_server.log

# æœç´¢é”™è¯¯
grep "ERROR" mt5_server.log

# æœç´¢ç‰¹å®šäº¤æ˜“
grep "XAUUSD" mt5_server.log
```

---

ğŸ‰ **æ­å–œï¼æ‚¨å·²æŒæ¡MT5äº¤æ˜“æœåŠ¡å™¨çš„å®Œæ•´ä½¿ç”¨æ–¹æ³•ï¼**

ğŸ“š **æ›´å¤šèµ„æº**:
- [APIæ–‡æ¡£](TRADINGVIEW_WEBHOOK_EXAMPLES.md)
- [è‡ªåŠ¨é‡è¿è¯´æ˜](AUTO_RECONNECT.md)
- [VSCodeè°ƒè¯•é…ç½®](.vscode/)
